%% polematrix documentation
%% Copyright (C) 2017 Jan Felix Schmidt <janschmidt@mailbox.org>
%%   
%% This program is free software: you can redistribute it and/or modify
%% it under the terms of the GNU General Public License as published by
%% the Free Software Foundation, either version 3 of the License, or
%% (at your option) any later version.
%%
%% This program is distributed in the hope that it will be useful,
%% but WITHOUT ANY WARRANTY; without even the implied warranty of
%% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%% GNU General Public License for more details.
%%
%% You should have received a copy of the GNU General Public License
%% along with this program.  If not, see <http://www.gnu.org/licenses/>.

\RequirePackage{xspace}

\newcommand*{\software}[1]{\emph{#1}\xspace}
\newcommand*{\ele}{\software{elegant}}
\newcommand*{\sdds}{\software{SDDS}}
\newcommand*{\madx}{\software{MAD-X}}
\newcommand*{\polem}{\software{polematrix}}
\newcommand*{\pal}{\software{palattice}}
\newcommand*{\xml}{\software{xml}}

\newcommand*{\cpp}{{C\nolinebreak[4]\hspace{-.05em}\raisebox{.2ex}{++}}\xspace}

% mathematical symbols
\newcommand{\dif}{\text{d}}
% spin vector
\newcommand*{\svec}[1][]{\ensuremath{\vec{S}_{#1}}\xspace}
\newcommand*{\sabs}[1][]{\ensuremath{|\svec[#1]|}\xspace}
\newcommand*{\sx}{\ensuremath{S_x}\xspace}
\newcommand*{\sz}{\ensuremath{S_z}\xspace}
\newcommand*{\slong}{\ensuremath{S_s}\xspace}
\newcommand*{\ga}{\ensuremath{\gamma a}\xspace}
\newcommand*{\sang}{\ensuremath{\vartheta}\xspace}
% polarization vector
\newcommand*{\pvec}[1][]{\ensuremath{\vec{P}_{#1}}\xspace}
\newcommand*{\pabs}{\ensuremath{|\pvec|}\xspace}
\newcommand*{\px}{\ensuremath{P_x}\xspace}
\newcommand*{\pz}{\ensuremath{P_z}\xspace}
\newcommand*{\plong}{\ensuremath{P_s}\xspace}
\newcommand*{\poli}{\ensuremath{P_i}\xspace}
\newcommand*{\polf}{\ensuremath{P_f}\xspace}
% longitudinal dynamics
\newcommand*{\ws}{\ensuremath{\omega_s}\xspace}
\newcommand*{\gcentral}{\ensuremath{\gamma_0}\xspace}
\newcommand*{\alphac}{\ensuremath{\alpha_c}\xspace}
\newcommand*{\alphactwo}{\ensuremath{\alpha_{c}^{(2)}}\xspace}
\newcommand*{\phf}{\ensuremath{\phi}\xspace}
% spin precession
\newcommand*{\wtbmt}{\ensuremath{\Omega_\text{TBMT}}\xspace}
\newcommand*{\wtbmtmov}{\ensuremath{\Omega_\text{TBMT,z}^\prime}\xspace}
\newcommand*{\wtbmtvec}{\ensuremath{\vec\Omega_\text{TBMT}}\xspace}
\newcommand*{\wrev}{\ensuremath{\omega_\text{rev}}\xspace}
% magnetic fields
\newcommand*{\bvec}{\ensuremath{\vec{B}}\xspace}
\newcommand*{\babs}{\ensuremath{\left|\bvec\right|}\xspace}
\newcommand*{\bx}{\ensuremath{\bvec_x}\xspace}
\newcommand*{\bz}{\ensuremath{\bvec_z}\xspace}
\newcommand*{\blong}{\ensuremath{\bvec_s}\xspace}
\newcommand*{\bpara}{\ensuremath{\bvec_\parallel}\xspace}
\newcommand*{\btrans}{\ensuremath{\bvec_\bot}\xspace}
\newcommand*{\bdip}{\ensuremath{B_z^\text{dip}}\xspace}
% normalized magnetic fields
\newcommand*{\bnvec}[1][]{\ensuremath{\vec{\mathcal{B}}_{#1}}\xspace}
\newcommand*{\bn}{\ensuremath{\mathcal{B}}\xspace}
\newcommand*{\bnabs}{\ensuremath{\left|\bn\right|}\xspace}
\newcommand*{\bnx}{\ensuremath{\bn_x}\xspace}
\newcommand*{\bnz}{\ensuremath{\bn_z}\xspace}
\newcommand*{\bnlong}{\ensuremath{\bn_s}\xspace}
\newcommand*{\bnpara}{\ensuremath{\bnvec[\parallel]}\xspace}
\newcommand*{\bntrans}{\ensuremath{\bnvec[\bot]}\xspace}
% momentum and energy
\newcommand*{\pcentral}{\ensuremath{p_0}\xspace}
% lattice
\newcommand*{\leff}{\ensuremath{l_\text{eff}}\xspace}
\newcommand*{\knullvec}{\ensuremath{\vec{k}_{0}}\xspace}
\newcommand*{\knull}[1]{\ensuremath{k_{0,#1}}\xspace}


% minted Setup
\RequirePackage{minted}

% fix caption distance
% http://texwelt.de/wissen/fragen/8305/wie-kann-ich-den-abstand-der-
% caption-zu-einem-mit-minted-erstelltem-listing-verringern
\RequirePackage{etoolbox}
\pretocmd{\listing}{%
  \apptocmd{\endminted}{\unskip}{}{\undefined}%
}{}{\undefined}

% general setup
\setminted{
  frame=lines, framesep=3\fboxsep,
  xleftmargin=8mm, xrightmargin=8mm,
  numberblanklines=false
}

% cpp setup
\newminted{cpp}{
  autogobble,
  linenos,
  breaklines,
  style=default,
  fontsize=\footnotesize,
}

% bash setup
\newminted{bash}{
  autogobble,
  breaklines,
  fontsize=\footnotesize
}

% xml setup
\newminted{xml}{
  autogobble,
  breaklines,
  fontsize=\footnotesize
}

% cpp-inline Setup
\newmintinline{cpp}{fontsize=\small}

% xml-inline setup
\newmintinline{xml}{fontsize=\small}

% bash-inline setup
\newmintinline{bash}{fontsize=\footnotesize}




% listings setup
\RequirePackage{listings}

\lstset{
  basicstyle=\ttfamily\small,
  breaklines=true,
  showstringspaces=false,
  escapeinside={(*}{*)}
}

% cpp setup
\lstdefinelanguage{cpp}[ISO]{c++}{
  keywordstyle=[1]\bfseries\color{purple},
  keywordstyle=[2]\color{cyan!80},
  keywordstyle=[3]\bfseries\color{green!50!black},
  commentstyle=\color{teal},
  stringstyle=\color{red!80!black},
  keywords=[1]{double,unsigned,int,void,string,bool,AccLattice, AccElement,
    SimToolInstance, FunctionOfPos, AccPair, AccTriple, Anchor, const_iterator, colvec},
  keywords=[2]{std,pal,arma}, keywords=[3]{for,while,if,else,const,return},
}


  
% Environment for documentation of configuration file entries
\RequirePackage{xparse}
\RequirePackage{xcolor}
\DeclareDocumentEnvironment{configdoc}{ m m m o }{
  \def\defaultval{#4}
  \noindent
  % \rule{\textwidth}{0.5pt}
  \underline{{\large\xmlinline{<#1>}}\hspace{5mm}{\footnotesize{\color{gray!60!black}\textsc{Type:}}
      \lstinline[language=cpp]@#2@\hspace{5mm}{\color{gray!60!black}\textsc{Unit:}} #3}
    \IfValueTF{#4}
    {\hspace{5mm}{\footnotesize{\color{gray!60!black}\textsc{Default Value:}} #4}}
    {}%\\[-2mm]
  }
  % \rule{\textwidth}{0.5pt}
  \begin{addmargin}[20pt]{0pt}
  }{
  \end{addmargin}
  \vspace{3mm}
}

\newenvironment{configdocgroup}[1]{
  \noindent
  \underline{{\large\xmlinline{<#1>}}\hspace{5mm}{\footnotesize{\color{gray!60!black}\textsc{Group}}}}
  \begin{addmargin}[20pt]{0pt}
  }{
  \end{addmargin}
  \vspace{3mm}
}